<!DOCTYPE html>
<html lang="en">
<head>
    <script type="module" src="../js/frontend/scripts/header.js"></script>
    <script type="text/javascript"> var exports = {}; </script>
    <title>Carer profile</title>
</head>

<body>
    <div class="centering_div" id="profileInfo">
        <h1 class="title">Missions</h1>
        <p>Id : <span id="profileId"></span></p>
        <p>Role de l'utilisateur : <span id="userRole"></span></p>
        <p class="error_message"></p>
        <div id="mission_list"></div>
    <div>
</body>

<script type="text/javascript" src="../ressources\bootstrap-5.0.2-dist\js/bootstrap.bundle.js" crossorigin="anonymous"></script>
<script type="module" src="../js/frontend/scripts/navbar_include.js"></script>


<script type="module">
    const recurenceMap = {
        1: "hebdomadaire",
        2: "mensuelle",
        3: "bi-mensuelle",
    }

    const profileId = new URLSearchParams(window.location.search).get("profileId")
    const role = new URLSearchParams(window.location.search).get("role")

    document.getElementById("profileId").innerText = profileId
    document.getElementById("userRole").innerText = role

    const res = await window.exposed.fetchMissions(profileId, role)

    if (res[0] == false){
        document.getElementsByClassName("error_message")[0].innerText = "Erreur " + res[1].statusCode + ", " + res[1].message;
    }
    if (res[0] == true){
        const missions = res[1]
        for (const mission of missions){
            document.getElementById("mission_list").insertAdjacentHTML('beforeend', `
            <p> De  : <span>${mission.startHour}</span></p>
            <p> À : <span>${mission.endHour}</span></p>
            <p> À partir du : <span>${mission.startDate}</span></p>
            <p> Validée : <span > ${mission.validated ? "oui": "non"}</span></p>
            <p> Client : <span >${mission.idClient}</span></p>
            <p> Employé assigné : <span >${mission.idEmployee}</span></p>
            <p> Auxiliaire de vie : <span >${mission.idCarer}</span></p>
            <p> Récurence : <span >${recurenceMap[mission.idRecurence]}</span></p>
        `)
        }
    }

</script>

</html>